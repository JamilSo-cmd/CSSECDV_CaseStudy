<!DOCTYPE html>
<html>
<head>
    <title>Reset Password</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .error-message {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #d32f2f;
            font-size: 14px;
        }

        .success-message {
            color: #388e3c;
            background-color: #e8f5e9;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #388e3c;
            font-size: 14px;
            text-align: center;
        }

        .info-message {
            color: #1976d2;
            background-color: #e3f2fd;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #1976d2;
            font-size: 13px;
        }

        .step-indicator {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 13px;
            color: #666;
        }

        .password-requirements {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #1976d2;
            font-size: 12px;
        }

        .password-requirements ul {
            margin: 5px 0;
            padding-left: 20px;
        }

        .password-requirements li {
            margin: 3px 0;
        }

        .back-link {
            text-align: center;
            margin-top: 15px;
        }

        .back-link a {
            color: #1976d2;
            text-decoration: none;
            font-size: 14px;
        }

        .back-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body class="login-background-image" background="https://1.bp.blogspot.com/-xyja6oSYgKA/Xa6NjVrvPAI/AAAAAAAAFpM/yjH0mh21a0IE_xynFmKbLqt1pX5GW_d8ACLcBGAsYHQ/w1200-h630-p-k-no-nu/De%2BLa%2BSalle%2BUniversity%2B%25281%2529.jpg">
    
    <h1 style="text-align: center;">RESET PASSWORD</h1>

    <% if (step === 1) { %>
        <!-- Step 1: Enter email -->
        <div class="logincontainer">
            <div class="inputcontainer">
                <div class="step-indicator">Step 1 of 2: Enter your email address</div>
                
                <% if (typeof error !== 'undefined' && error) { %>
                    <div class="error-message"><%= error %></div>
                <% } %>

                <div class="info-message">
                    Enter your email address and we'll help you reset your password using your security question.
                </div>

                <form action="/reset-password" method="post">
                    <label for="email">DLSU E-mail Address:</label><br><br>
                    <input type="email" id="email" name="email" required><br><br><br>

                    <input type="submit" value="Continue"><br><br>

                    <div class="back-link">
                        <a href="/login">← Back to Login</a>
                    </div>
                </form>
            </div>
        </div>

    <% } else if (step === 2) { %>
        <!-- Step 2: Answer security question and set new password -->
        <div class="signupcontainer">
            <div class="signup-inputcontainer">
                <div class="step-indicator">Step 2 of 2: Answer security question and create new password</div>
                
                <% if (typeof error !== 'undefined' && error) { %>
                    <div class="error-message"><%= error %></div>
                <% } %>

                <form action="/reset-password" method="post" onsubmit="return validatePasswordReset()">
                    <input type="hidden" name="email" value="<%= email %>">

                    <div class="info-message">
                        <strong>Security Question:</strong><br>
                        <%= securityQuestion %>
                    </div>

                    <label for="securityAnswer">Your Answer:</label><br><br>
                    <input type="text" id="securityAnswer" name="securityAnswer" required 
                           placeholder="Enter your answer"><br><br>

                    <div class="password-requirements">
                        <strong>New Password Requirements:</strong>
                        <ul>
                            <li>At least 8 characters long</li>
                            <li>At least one uppercase letter</li>
                            <li>At least one number</li>
                            <li>At least one special character (!@#$%^&*)</li>
                        </ul>
                    </div>

                    <label for="newPassword">New Password:</label><br><br>
                    <input type="password" id="newPassword" name="newPassword" required><br><br>

                    <label for="confirmPassword">Confirm New Password:</label><br><br>
                    <input type="password" id="confirmPassword" name="confirmPassword" required><br><br><br>

                    <input type="submit" value="Reset Password"><br><br>

                    <div class="back-link">
                        <a href="/login">← Back to Login</a>
                    </div>
                </form>
            </div>
        </div>

        <script>
            function validatePasswordReset() {
                const password = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (password !== confirmPassword) {
                    alert("Passwords do not match. Please try again.");
                    return false;
                }

                const hasLength = password.length >= 8;
                const hasUppercase = /[A-Z]/.test(password);
                const hasNumber = /[0-9]/.test(password);
                const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);

                if (!hasLength) {
                    alert("Password must be at least 8 characters long.");
                    return false;
                }
                if (!hasUppercase) {
                    alert("Password must contain at least one uppercase letter.");
                    return false;
                }
                if (!hasNumber) {
                    alert("Password must contain at least one number.");
                    return false;
                }
                if (!hasSpecial) {
                    alert("Password must contain at least one special character.");
                    return false;
                }

                return true;
            }
        </script>

    <% } else if (step === 3 && success) { %>
        <!-- Step 3: Success message -->
        <div class="logincontainer">
            <div class="inputcontainer">
                <div class="success-message">
                    ✓ Password successfully reset!<br><br>
                    You can now log in with your new password.
                </div>

                <div class="back-link">
                    <a href="/login">← Back to Login</a>
                </div>
            </div>
        </div>

    <% } %>

</body>
</html>
